<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sustainable Homes — Premium Off-Grid Listings</title>

  <!-- Basic SEO defaults (router updates these on navigation) -->
  <link id="seo-canonical" rel="canonical" href="" />
  <meta id="seo-description" name="description" content="Curated sustainable and off-grid homes with a featured premium property." />
  <meta property="og:type" content="website" />
  <meta id="og-title" property="og:title" content="Sustainable Homes — Premium Off-Grid Listings" />
  <meta id="og-description" property="og:description" content="Curated sustainable and off-grid homes with a featured premium property." />
  <meta id="og-url" property="og:url" content="" />
  <meta id="twitter-title" name="twitter:title" content="Sustainable Homes — Premium Off-Grid Listings" />
  <meta id="twitter-description" name="twitter:description" content="Curated sustainable and off-grid homes with a featured premium property." />
  <meta name="twitter:card" content="summary_large_image" />

  <style>
    :root {
      --brand: #1c7d57;
      --brand-dark: #135a3e;
      --bg: #0a0a0a;
      --panel: #111214;
      --muted: #9aa3ad;
      --text: #e8edf1;
      --chip: #213029;
      --chip-text: #bce3cf;
      --cta: #e8f7ef;
    }
    * { box-sizing: border-box; }
    html, body { margin: 0; padding: 0; background: var(--bg); color: var(--text); font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; }
    a { color: var(--cta); text-decoration: none; }
    header { position: sticky; top: 0; z-index: 20; background: linear-gradient(180deg, #0a0a0a, rgba(10,10,10,0.8)); border-bottom: 1px solid rgba(255,255,255,0.06); }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 16px; }
    .brand { display: flex; align-items: center; gap: 12px; }
    .brand .logo { width: 28px; height: 28px; border-radius: 4px; background: var(--brand); display: inline-block; }
    .brand h1 { font-size: 18px; margin: 0; font-weight: 600; letter-spacing: 0.2px; }
    .hero { padding: 24px 16px 8px; }
    .hero .premium { display: grid; grid-template-columns: 1.3fr 1fr; gap: 16px; background: var(--panel); border: 1px solid rgba(255,255,255,0.06); border-radius: 12px; overflow: hidden; }
    .premium .media { position: relative; min-height: 260px; background: #000; }
    .premium .media img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .premium .badge { position: absolute; top: 12px; left: 12px; background: var(--chip); color: var(--chip-text); padding: 6px 10px; border-radius: 999px; font-size: 12px; border: 1px solid rgba(255,255,255,0.08);}
    .premium .content { padding: 16px; display: flex; flex-direction: column; gap: 8px; }
    .premium h2 { margin: 0; font-size: 22px; }
    .muted { color: var(--muted); }
    .stats { display: flex; gap: 10px; flex-wrap: wrap; font-size: 13px; }
    .chip { background: var(--chip); color: var(--chip-text); padding: 6px 10px; border-radius: 999px; border: 1px solid rgba(255,255,255,0.06); }
    .actions { display: flex; gap: 8px; margin-top: 8px; flex-wrap: wrap; }
    .btn { padding: 10px 14px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.12); background: #15171a; color: #fff; cursor: pointer; font-size: 14px; }
    .btn.primary { background: var(--brand); border-color: var(--brand-dark); }
    .filters { margin: 24px 0 8px; display: flex; gap: 14px; flex-wrap: wrap; align-items: center; }
    .filters label { display: inline-flex; align-items: center; gap: 6px; font-size: 14px; }
    .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 14px; }
    .card { background: var(--panel); border: 1px solid rgba(255,255,255,0.06); border-radius: 10px; overflow: hidden; display: flex; flex-direction: column; }
    .card .imgbox { aspect-ratio: 4/3; background: #000; }
    .card .imgbox img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .card .body { padding: 12px; display: grid; gap: 6px; }
    .card h3 { margin: 0; font-size: 16px; }
    .card .cta-row { display: flex; gap: 8px; margin-top: 4px; }
    .section { display: none; }
    .section.active { display: block; }
    footer { margin: 40px 0 60px; color: var(--muted); }

    /* Modal gallery (hidden by default) */
    .modal { position: fixed; inset: 0; display: none; place-items: center; background: rgba(0,0,0,0.7); z-index: 50; }
    .modal[aria-hidden="false"] { display: grid; }
    .lightbox { background: #000; border-radius: 10px; width: min(96vw, 1100px); height: min(86vh, 800px); display: grid; grid-template-rows: auto 1fr; overflow: hidden; }
    .lightbox header { background: #0b0b0b; border-bottom: 1px solid rgba(255,255,255,0.08); display: flex; align-items: center; justify-content: space-between; padding: 10px 12px; }
    .lightbox header .title { font-weight: 600; }
    .lightbox .stage { position: relative; display: grid; }
    .lightbox img { width: 100%; height: 100%; object-fit: contain; background: #000; }
    .lightbox nav { position: absolute; inset: 0; display: flex; align-items: center; justify-content: space-between; pointer-events: none; }
    .lightbox button { pointer-events: auto; background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.18); color: #fff; padding: 8px 10px; border-radius: 8px; cursor: pointer; }
    @media (max-width: 900px) {
      .hero .premium { grid-template-columns: 1fr; }
      .grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap brand">
      <span class="logo" aria-hidden="true"></span>
      <h1>Sustainable Homes</h1>
    </div>
  </header>

  <main class="wrap">
    <!-- HOME -->
    <section id="home" class="section active">
      <div class="hero">
        <article class="premium" id="premium-card">
          <div class="media"><img alt="Premium hero" id="premium-hero" /></div>
          <div class="content">
            <span class="badge">Premium Listing</span>
            <h2 id="premium-title"></h2>
            <div id="premium-address" class="muted"></div>
            <div id="premium-price" class="muted"></div>
            <div id="premium-stats" class="stats"></div>
            <div class="actions">
              <a id="btn-view-details" class="btn primary" href="#premium-details">View details</a>
              <button id="btn-view-photos" class="btn" type="button">View photos</button>
              <a id="btn-contact" class="btn" href="#">Contact agent</a>
            </div>
          </div>
        </article>
      </div>

      <div class="filters">
        <strong>Filter:</strong>
        <label><input type="checkbox" value="off-grid" /> Off-grid</label>
        <label><input type="checkbox" value="solar" /> Solar</label>
        <label><input type="checkbox" value="battery" /> Battery</label>
        <label><input type="checkbox" value="water" /> Water</label>
        <label><input type="checkbox" value="efficiency" /> Efficiency</label>
        <button id="btn-clear" class="btn" type="button">Clear</button>
      </div>

      <section aria-label="Listings">
        <div id="cards" class="grid"></div>
      </section>
    </section>

    <!-- PREMIUM DETAILS -->
    <section id="premium-details" class="section">
      <article class="wrap-in">
        <h2 id="pd-title" style="margin:0 0 4px 0;"></h2>
        <div id="pd-address" class="muted"></div>
        <div id="pd-price" class="muted" style="margin-bottom:8px;"></div>
        <div id="pd-stats" class="stats" style="margin-bottom:12px;"></div>
        <p id="pd-summary" class="muted" style="margin-bottom:8px;"></p>
        <p id="pd-long"></p>
        <div class="actions" style="margin:10px 0 18px;">
          <a id="pd-contact" class="btn primary" href="#">Contact agent</a>
          <button id="pd-photos" class="btn" type="button">View photos</button>
          <a class="btn" href="#home">Back to listings</a>
        </div>
      </article>
    </section>
  </main>

  <!-- SUBMIT A HOME (Formspree) -->
  <section class="wrap" aria-label="Submit a home" style="margin-top: 30px;">
    <h3>Submit a Sustainable/Off-Grid Home</h3>
    <form id="submit-home" action="https://formspree.io/f/mqalnenq" method="POST">
      <div style="display:grid; gap:10px; grid-template-columns:1fr 1fr;">
        <input name="name" placeholder="Your name" required />
        <input name="email" type="email" placeholder="Your email" required />
        <input name="title" placeholder="Home title" required />
        <input name="address" placeholder="Address" required />
        <textarea name="message" placeholder="Describe sustainability/off-grid features" rows="4" style="grid-column:1/-1;"></textarea>
      </div>
      <button class="btn primary" type="submit" style="margin-top:10px;">Send</button>
    </form>
  </section>

  <footer class="wrap">
    <small>&copy; <span id="year"></span> Sustainable Homes. Curated off-grid listings.</small>
  </footer>

  <!-- GALLERY MODAL (hidden by default) -->
  <div id="gallery-modal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="lightbox">
      <header>
        <div class="title" id="gallery-title">Gallery</div>
        <button id="gallery-close" type="button" aria-label="Close">&times;</button>
      </header>
      <div class="stage">
        <img id="gallery-img" alt="Gallery image" />
        <nav>
          <button id="gallery-prev" type="button" aria-label="Previous">&#8592;</button>
          <button id="gallery-next" type="button" aria-label="Next">&#8594;</button>
        </nav>
      </div>
    </div>
  </div>

  <script>
  (function () {
    'use strict';

    // ---- Namespace (avoid duplicate globals and redeclarations) ----
    window.SH = window.SH || {};

    // DOM helpers (define once)
    SH.dom = SH.dom || {
      qs: (sel, root = document) => root.querySelector(sel),
      qsa: (sel, root = document) => Array.from(root.querySelectorAll(sel))
    };

    // One-time boot function (safe to call repeatedly)
    SH.boot = SH.boot || function boot() {
      if (SH.__INITIALIZED__) {
        console.info('[SH] Boot skipped (already initialized).');
        return;
      }
      SH.__INITIALIZED__ = true;

      const { qs, qsa } = SH.dom;

      // ---- Data ----------------------------------------------------
      SH.data = SH.data || {};
      SH.data.listings = SH.data.listings || [
        // PREMIUM
        {
          id: 'perfect-north',
          premium: true,
          title: "Perfect North: A Stunning Showcase of Australiana",
          address: "947 Coomba Road, Whoota NSW 2428",
          price: "$2,400,000",
          beds: 3, baths: 3, cars: 6, land: "25 acres",
          summary: "Constructed to the highest standards, fully self-sufficient and designed to live in harmony with the landscape.",
          long: "947 Coomba Road has been constructed to the highest standards, with exceptional craftsmanship throughout. Designed with sustainability at its core, the fully self-sufficient retreat integrates effortlessly with its natural surroundings.\n\nPerched atop a hill on 25 acres, the masterpiece offers breathtaking views of Wallis Lake. Within 500m from boat ramps, the property is perfectly located for those who love boating, fishing, or lake activities.\n\nAs you meander up the winding driveway, you'll reach this remarkable residence, which is filled with distinctive features and superior finishes.\n\nThe expansive upstairs living room showcases soaring ceilings and breathtaking views across the Lake, extending to the deep blue ocean beyond. The wide, wrap-around decks provide an ideal setting for entertaining or simply relaxing while listening to the soothing sounds of the native birds. As you watch Eagles soar above, you'll feel a deep sense of harmony with the environment, which provides your off-grid power & water supply.\n\nThe interior features expansive living spaces, including a large media room, burnished concrete floors downstairs, and spotted gum timber accents throughout. The bathrooms are equipped with heated towel rails, while touchscreen-operated windows ensure efficient cooling. Soft, night-time lighting in the hallways and stairways adds to the home's warmth and comfort.\n\nWith a focus on sustainability, this home incorporates countless eco-friendly features, including cross-flow ventilation, on-site milled timber features, large water catchment systems, and 12.6kW of solar power with lithium-iron batteries, SMA Sunny Island inverters plus a generator backup system. Designed and engineered with meticulous care, it takes full advantage of its location, aspect, and natural resources. For added convenience, there is double driveway access and triple garage spaces with varying clearance heights (2m, 2.5m, and 3m). The home is also set within BAL 19 and has fire sprinklers, offering peace of mind.\n\nThis home is a true testament to sustainable design, offering an extraordinary living experience that combines modern comforts with an unwavering respect for the environment. 'Perfect North' is a rare and remarkable place to live, unwind, and thrive in harmony with nature.",
          features: ["off-grid", "solar", "battery", "water", "efficiency"],
          images: [
            "https://images.unsplash.com/photo-1502672023488-70e25813eb80?q=80&w=1600&auto=format&fit=crop",
            "https://images.unsplash.com/photo-1501183638710-841dd1904471?q=80&w=1600&auto=format&fit=crop",
            "https://images.unsplash.com/photo-1502003148287-a82ef80a6abc?q=80&w=1600&auto=format&fit=crop",
            "https://images.unsplash.com/photo-1449844908441-8829872d2607?q=80&w=1600&auto=format&fit=crop"
          ],
          contactHref: "mailto:mark@thepalms.com.au?subject=Enquiry%20about%20947%20Coomba%20Road"
        },
        // EXAMPLE: non-premium with photos
        {
          id: 'solar-haven',
          premium: false,
          title: "Solar Haven with Battery & Rainwater",
          address: "8 Ridgeway, Smiths Lake NSW",
          price: "Guide $980k",
          beds: 3, baths: 2, cars: 2, land: "800 m²",
          features: ["solar", "battery", "efficiency"],
          images: ["https://images.unsplash.com/photo-1560518883-ce09059eeffa?q=80&w=1600&auto=format&fit=crop"],
          contactHref: "#"
        },
        // EXAMPLE: non-premium with NO photos (for test + your requirement)
        {
          id: 'no-photos-test',
          premium: false,
          title: "Rainwater & Efficient Design (No Photos Yet)",
          address: "21 Woodland Rise, Coomba Park NSW",
          price: "Guide $790k",
          beds: 2, baths: 1, cars: 2, land: "1.2 acres",
          features: ["off-grid", "water", "efficiency"],
          images: [],
          contactHref: "#"
        }
      ];

      // ---- Elements -------------------------------------------------
      const els = {
        year: qs('#year'),
        home: qs('#home'),
        grid: qs('#cards'),
        filters: qsa('.filters input[type="checkbox"]'),
        clear: qs('#btn-clear'),
        // Premium
        pHero: qs('#premium-hero'),
        pTitle: qs('#premium-title'),
        pAddress: qs('#premium-address'),
        pPrice: qs('#premium-price'),
        pStats: qs('#premium-stats'),
        pBtnPhotos: qs('#btn-view-photos'),
        pBtnContact: qs('#btn-contact'),
        // Details
        pdSec: qs('#premium-details'),
        pdTitle: qs('#pd-title'),
        pdAddr: qs('#pd-address'),
        pdPrice: qs('#pd-price'),
        pdStats: qs('#pd-stats'),
        pdSummary: qs('#pd-summary'),
        pdLong: qs('#pd-long'),
        pdBtnPhotos: qs('#pd-photos'),
        pdBtnContact: qs('#pd-contact'),
        // Gallery
        modal: qs('#gallery-modal'),
        gClose: qs('#gallery-close'),
        gPrev: qs('#gallery-prev'),
        gNext: qs('#gallery-next'),
        gImg: qs('#gallery-img'),
        gTitle: qs('#gallery-title'),
        // SEO
        seoCanon: qs('#seo-canonical'),
        seoDesc: qs('#seo-description'),
        ogTitle: qs('#og-title'),
        ogDesc: qs('#og-description'),
        ogUrl: qs('#og-url'),
        twTitle: qs('#twitter-title'),
        twDesc: qs('#twitter-description')
      };

      // ---- Render Premium -------------------------------------------
      const premium = SH.data.listings.find(x => x.premium);
      function renderPremium() {
        if (!premium) return;
        const hasPhotos = Array.isArray(premium.images) && premium.images.length > 0;

        els.pHero.src = hasPhotos ? premium.images[0] : '';
        els.pTitle.textContent = premium.title;
        els.pAddress.textContent = premium.address;
        els.pPrice.textContent = premium.price;
        els.pStats.innerHTML = [
          `<span class="chip">${premium.beds} bed</span>`,
          `<span class="chip">${premium.baths} bath</span>`,
          `<span class="chip">${premium.cars} car</span>`,
          `<span class="chip">${premium.land}</span>`
        ].join('');
        els.pBtnContact.href = premium.contactHref;

        // Hide/show photos buttons per requirement
        els.pBtnPhotos.style.display = hasPhotos ? '' : 'none';
        els.pdBtnPhotos.style.display = hasPhotos ? '' : 'none';

        if (hasPhotos) {
          els.pBtnPhotos.onclick = () => openGallery(premium.title, premium.images, 0);
          els.pdBtnPhotos.onclick = () => openGallery(premium.title, premium.images, 0);
        } else {
          els.pBtnPhotos.onclick = null;
          els.pdBtnPhotos.onclick = null;
        }

        // Details content
        els.pdBtnContact.href = premium.contactHref;
        els.pdTitle.textContent = premium.title;
        els.pdAddr.textContent = premium.address;
        els.pdPrice.textContent = premium.price;
        els.pdStats.innerHTML = els.pStats.innerHTML;
        els.pdSummary.textContent = premium.summary;
        els.pdLong.textContent = premium.long;
      }

      // ---- Cards ----------------------------------------------------
      function activeFilters() {
        return els.filters.filter(cb => cb.checked).map(cb => cb.value);
      }
      function visible(listing, filters) {
        if (listing.premium) return false; // premium is not in the grid
        if (!filters.length) return true;
        return filters.every(f => listing.features.includes(f));
      }
      function renderGrid() {
        const filters = activeFilters();
        const items = SH.data.listings.filter(l => visible(l, filters));

        els.grid.innerHTML = items.map(l => {
          const hasPhotos = Array.isArray(l.images) && l.images.length > 0;
          return `
          <article class="card listing-card" data-id="${l.id}">
            <div class="imgbox"><img alt="${l.title}" src="${hasPhotos ? l.images[0] : ''}"></div>
            <div class="body">
              <h3>${l.title}</h3>
              <div class="muted">${l.address}</div>
              <div class="muted">${l.price}</div>
              <div class="stats">
                <span class="chip">${l.beds} bed</span>
                <span class="chip">${l.baths} bath</span>
                <span class="chip">${l.cars} car</span>
                ${l.land ? `<span class="chip">${l.land}</span>` : ''}
              </div>
              <div class="cta-row">
                ${hasPhotos ? `<button class="btn" data-action="photos" type="button">View photos</button>` : ''}
                ${l.contactHref ? `<a class="btn" href="${l.contactHref}">Contact</a>` : ''}
              </div>
            </div>
          </article>`;
        }).join('');

        // wire up the photo buttons
        qsa('[data-action="photos"]', els.grid).forEach(btn => {
          btn.addEventListener('click', e => {
            const card = e.target.closest('.card');
            const id = card?.getAttribute('data-id');
            const l = SH.data.listings.find(x => x.id === id);
            if (l && Array.isArray(l.images) && l.images.length) openGallery(l.title, l.images, 0);
          });
        });
      }

      // ---- Gallery (modal) -----------------------------------------
      let gIndex = 0;
      let gImages = [];
      function openGallery(title, images, start) {
        gIndex = start || 0;
        gImages = images || [];
        els.gTitle.textContent = title || 'Gallery';
        updateGallery();
        els.modal.setAttribute('aria-hidden', 'false');
      }
      function closeGallery() {
        els.modal.setAttribute('aria-hidden', 'true');
      }
      function updateGallery() {
        if (!gImages.length) { els.gImg.removeAttribute('src'); return; }
        els.gImg.src = gImages[gIndex];
      }
      els.gPrev.addEventListener('click', () => { if (!gImages.length) return; gIndex = (gIndex - 1 + gImages.length) % gImages.length; updateGallery(); });
      els.gNext.addEventListener('click', () => { if (!gImages.length) return; gIndex = (gIndex + 1) % gImages.length; updateGallery(); });
      els.gClose.addEventListener('click', closeGallery);
      els.modal.addEventListener('click', (e) => { if (e.target === els.modal) closeGallery(); });

      // ---- Filters --------------------------------------------------
      els.filters.forEach(cb => cb.addEventListener('change', renderGrid));
      els.clear.addEventListener('click', () => { els.filters.forEach(cb => cb.checked = false); renderGrid(); });

      // ---- Router + SEO --------------------------------------------
      function absolute(url) {
        try { return new URL(url, window.location.origin).href; }
        catch { return window.location.href; }
      }
      function setSEOHome() {
        const title = 'Sustainable Homes — Premium Off-Grid Listings';
        const desc = 'Curated sustainable and off-grid homes with a featured premium property.';
        const url = absolute(window.location.pathname + '#home');

        document.title = title;
        els.seoCanon.href = absolute(window.location.pathname);
        els.seoDesc.content = desc;
        els.ogTitle.content = title;
        els.ogDesc.content = desc;
        els.ogUrl.content = url;
        els.twTitle.content = title;
        els.twDesc.content = desc;
      }
      function setSEOPremium() {
        const p = premium;
        const title = `${p.title} — Sustainable Homes`;
        const desc = (p.summary || '').slice(0, 200);
        const url = absolute(window.location.pathname + '#premium-details');

        document.title = title;
        els.seoCanon.href = url;
        els.seoDesc.content = desc;
        els.ogTitle.content = title;
        els.ogDesc.content = desc;
        els.ogUrl.content = url;
        els.twTitle.content = title;
        els.twDesc.content = desc;
      }
      function route() {
        const hash = (window.location.hash || '#home').toLowerCase();
        const isPremium = hash.includes('premium-details');
        qs('#home').classList.toggle('active', !isPremium);
        qs('#premium-details').classList.toggle('active', isPremium);
        if (isPremium) setSEOPremium(); else setSEOHome();
      }
      SH.route = route;

      // ---- Boot sequence -------------------------------------------
      els.year.textContent = new Date().getFullYear();
      renderPremium();
      renderGrid();
      route();
      window.addEventListener('hashchange', route);

      // ---- Self-tests ----------------------------------------------
      SH.test = SH.test || {};
      SH.test.run = function () {
        const results = [];
        function ok(cond, msg) { results.append if cond else None
        }
        function report(cond, msg) { console[cond ? 'log' : 'error']((cond ? '[TEST PASS] ' : '[TEST FAIL] ') + msg); }
        function t(cond, msg) { report(!!cond, msg); return !!cond; }
        // 1) helpers exist, and no global qs
        t(typeof SH.dom.qs === 'function' && typeof SH.dom.qsa === 'function', 'helpers present (no global qs/qsa)');
        t(!('qs' in window), 'no global qs binding exists');
        // 2) premium rendered
        t(!!SH.dom.qs('#premium-title')?.textContent, 'premium title rendered');
        // 3) grid count stable on double-boot
        const before = SH.dom.qsa('.listing-card').length;
        SH.boot(); // second call should be no-op
        const after = SH.dom.qsa('.listing-card').length;
        t(before === after, 'double boot does not duplicate cards');
        // 4) modal hidden by default
        t(SH.dom.qs('#gallery-modal').getAttribute('aria-hidden') === 'true', 'gallery modal hidden on load');
        // 5) router toggles sections
        const prevHash = location.hash;
        location.hash = '#premium-details'; SH.route();
        t(SH.dom.qs('#premium-details').classList.contains('active'), 'premium details active after routing');
        location.hash = prevHash || '#home'; SH.route();
        // 6) photos button hidden for listings with no images
        const noPhotosCard = SH.dom.qs('.listing-card[data-id="no-photos-test"]');
        t(!!noPhotosCard, 'no-photos test listing exists');
        t(!noPhotosCard?.querySelector('[data-action="photos"]'), 'no-photos listing has no View photos button');
        return results;
      };
      // Run tests on first boot
      setTimeout(() => { try { SH.test.run(); } catch(e) { console.warn('Self-tests error', e); } }, 0);
    };

    // Kick it off (safe to run twice; guarded)
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', SH.boot);
    } else {
      SH.boot();
    }
  })();
  </script>
</body>
</html>
